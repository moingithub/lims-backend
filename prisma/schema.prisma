generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id                 Int                 @id @default(autoincrement())
  name               String
  email              String              @unique
  password           String
  role_id            Int?
  company_id         Int?
  active             Boolean             @default(true)
  created_by_id      Int?
  created_at         DateTime            @default(now())
  updated_at         DateTime            @updatedAt
  analysisPricings   analysis_pricing[]
  companies          companies[]
  companyAreas       company_areas[]
  companyContacts    company_contacts[]
  cylinderCheckouts  cylinder_checkout[]
  cylinders          cylinders[]
  modules            modules[]
  roleModules        role_modules[]
  roles              roles[]
  sampleCheckins     sample_checkin[]
  company            companies?          @relation("CompanyUsers", fields: [company_id], references: [id])
  role               roles?              @relation("RoleUsers", fields: [role_id], references: [id])
  workorders_created workorder_headers[]
}

model companies {
  id                Int                 @id @default(autoincrement())
  code              String              @unique
  name              String              @unique
  phone             String?
  email             String?
  billing_ref       String?
  billing_ref_no    String?
  billing_address   String?
  active            Boolean             @default(true)
  created_by_id     Int?
  created_at        DateTime            @default(now())
  updated_at        DateTime            @updatedAt
  created_by        users?              @relation(fields: [created_by_id], references: [id], onDelete: Restrict)
  companyAreas      company_areas[]
  companyContacts   company_contacts[]
  sampleCheckins    sample_checkin[]
  users             users[]             @relation("CompanyUsers")
  workorder_headers workorder_headers[]
}

model roles {
  id            Int            @id @default(autoincrement())
  name          String         @unique
  description   String?
  active        Boolean        @default(true)
  created_by_id Int?
  created_at    DateTime       @default(now())
  updated_at    DateTime       @updatedAt
  role_modules  role_modules[]
  created_by    users?         @relation(fields: [created_by_id], references: [id], onDelete: Restrict)
  users         users[]        @relation("RoleUsers")
}

model modules {
  id            Int            @id @default(autoincrement())
  name          String         @unique
  description   String?
  active        Boolean        @default(true)
  created_by_id Int
  created_at    DateTime       @default(now())
  updated_at    DateTime       @updatedAt
  created_by    users          @relation(fields: [created_by_id], references: [id])
  role_modules  role_modules[]
}

model role_modules {
  id            Int      @id @default(autoincrement())
  role_id       Int
  module_id     Int
  active        Boolean  @default(true)
  created_by_id Int
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  created_by    users    @relation(fields: [created_by_id], references: [id])
  module        modules  @relation(fields: [module_id], references: [id], onDelete: Cascade)
  role          roles    @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@unique([role_id, module_id])
}

model company_areas {
  id             Int              @id @default(autoincrement())
  company_id     Int
  area           String
  region         String
  description    String?
  active         Boolean          @default(true)
  created_by_id  Int
  created_at     DateTime         @default(now())
  updated_at     DateTime         @updatedAt
  company        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade)
  created_by     users            @relation(fields: [created_by_id], references: [id])
  sampleCheckins sample_checkin[]

  @@unique([company_id, area])
}

model company_contacts {
  id             Int              @id @default(autoincrement())
  company_id     Int
  name           String
  phone          String
  email          String
  active         Boolean          @default(true)
  created_by_id  Int
  created_at     DateTime         @default(now())
  updated_at     DateTime         @updatedAt
  company        companies        @relation(fields: [company_id], references: [id], onDelete: Cascade)
  created_by     users            @relation(fields: [created_by_id], references: [id])
  sampleCheckins sample_checkin[]

  @@unique([company_id, name])
}

model cylinders {
  id              Int              @id @default(autoincrement())
  cylinder_number String           @unique
  cylinder_type   String
  track_inventory Boolean          @default(true)
  location        String
  active          Boolean          @default(true)
  created_by_id   Int
  created_at      DateTime         @default(now())
  updated_at      DateTime         @updatedAt
  created_by      users            @relation(fields: [created_by_id], references: [id])
  sampleCheckins  sample_checkin[]
}

model analysis_pricing {
  id             Int              @id @default(autoincrement())
  analysis_type  String           @unique
  description    String?
  standard_rate  Decimal          @db.Decimal(12, 2)
  rushed_rate    Decimal          @db.Decimal(12, 2)
  sample_fee     Decimal          @db.Decimal(12, 2)
  active         Boolean          @default(true)
  created_by_id  Int
  created_at     DateTime         @default(now())
  updated_at     DateTime         @updatedAt
  created_by     users            @relation(fields: [created_by_id], references: [id])
  sampleCheckins sample_checkin[]
}

model cylinder_checkout {
  id                 Int       @id @default(autoincrement())
  cylinder_id        Int
  company_id         Int
  company_contact_id Int
  is_returned        Boolean   @default(false)
  returned_at        DateTime?
  created_by_id      Int
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt
  created_by         users     @relation(fields: [created_by_id], references: [id])

  @@index([is_returned])
}

model sample_checkin {
  id                 Int              @id @default(autoincrement())
  company_id         Int
  company_contact_id Int
  analysis_type_id   Int
  area_id            Int?
  customer_cylinder  Boolean          @default(false)
  rushed             Boolean          @default(false)
  sampled_by_lab     Boolean          @default(false)
  cylinder_id        Int?
  cylinder_number    String?
  analysis_number    String           @unique
  producer           String?
  well_name          String?
  meter_number       String?
  sample_type        String
  flow_rate          String?
  pressure           String?
  pressure_unit      String
  temperature        String?
  field_h2s          String?
  cost_code          String?
  checkin_type       String
  invoice_ref_name   String?
  invoice_ref_value  String?
  remarks            String?
  scanned_tag_image  String?
  work_order_number  String?
  status             String
  standard_rate      Decimal          @default(0) @db.Decimal(12, 2)
  applied_rate       Decimal          @default(0) @db.Decimal(12, 2)
  sample_fee         Decimal          @default(0) @db.Decimal(12, 2)
  h2_pop_fee         Decimal          @default(0) @db.Decimal(12, 2)
  spot_composite_fee Decimal          @default(0) @db.Decimal(12, 2)
  created_by_id      Int
  created_at         DateTime         @default(now())
  updated_at         DateTime         @updatedAt
  analysis_pricing   analysis_pricing @relation(fields: [analysis_type_id], references: [id])
  company_area       company_areas?   @relation(fields: [area_id], references: [id])
  company_contact    company_contacts @relation(fields: [company_contact_id], references: [id])
  company            companies        @relation(fields: [company_id], references: [id])
  created_by         users            @relation(fields: [created_by_id], references: [id])
  cylinder           cylinders?       @relation(fields: [cylinder_id], references: [id], onDelete: Restrict)

  @@index([company_id])
  @@index([status])
}

model workorder_headers {
  id                    Int       @id @default(autoincrement())
  company_id            Int
  work_order_date       DateTime  @default(now())
  work_order_number     String    @unique
  cylinders             Int       @default(0)
  mileage_fee           Decimal   @db.Decimal(12, 2)
  miscellaneous_charges Decimal   @db.Decimal(12, 2)
  hourly_fee            Decimal   @db.Decimal(12, 2)
  status                String
  created_by_id         Int
  created_at            DateTime  @default(now())
  updated_at            DateTime  @updatedAt
  company               companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
  created_by            users     @relation(fields: [created_by_id], references: [id])
}

view open_checkout {
  id              Int?
  company_name    String?
  cylinder_type   String?
  cylinder_number String?
  contact_name    String?
  phone           String?
  email           String?
  checkout_date   DateTime?
}
